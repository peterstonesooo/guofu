<div class="container-fluid">
    <div class="row">
        <div class="col-xs-12">
            <div class="box box-primary">
                <div class="box-header">
                    <div class="box-tools">
                        <form class="form-inline">
                            <div class="form-group">
                                <input type="text" class="form-control input-sm" name="user_id" placeholder="用户ID">
                            </div>
                            <div class="form-group">
                                <select class="form-control input-sm" name="stock_type_id">
                                    <option value="">所有股权</option>
                                    {volist name="stockTypes" id="vo"}
                                        <option value="{$vo.id}">{$vo.name}</option>
                                    {/volist}
                                </select>
                            </div>
                            <div class="form-group">
                                <select class="form-control input-sm" name="type">
                                    <option value="">所有类型</option>
                                    <option value="1">买入</option>
                                    <option value="2">卖出</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <select class="form-control input-sm" name="status">
                                    <option value="">所有状态</option>
                                    <option value="1">成功</option>
                                    <option value="0">失败</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <input type="text" class="form-control input-sm" name="date_range" id="date-range"
                                       placeholder="交易日期">
                            </div>
                            <button type="button" class="btn btn-sm btn-primary" id="search-btn">
                                <i class="fa fa-search"></i> 搜索
                            </button>
                        </form>
                    </div>
                </div>
                <div class="box-body">
                    <table id="dataTable" class="table table-bordered table-hover">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>用户</th>
                            <th>手机号</th>
                            <th>股权名称</th>
                            <th>交易类型</th>
                            <th>数量</th>
                            <th>单价</th>
                            <th>总金额</th>
                            <th>状态</th>
                            <th>来源</th>
                            <th>备注</th>
                            <th>交易时间</th>
                        </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<link href="__ADMIN__/plugins/datatable/datatables.min.css" rel="stylesheet">
<script src="__ADMIN__/plugins/datatable/datatables.min.js"></script>
<script>
    $(function () {
        // 初始化日期范围选择
        laydate.render({
            elem: '#date-range',
            range: true,
            max: 0
        });

        // 初始化表格
        var table = $('#dataTable').DataTable({
            'paging': true,
            'lengthChange': true,
            'searching': false,
            'ordering': true,
            'info': true,
            'autoWidth': false,
            'serverSide': true,
            ajax: {
                url: "{:url('admin/stock_transaction/index')}",
                type: 'POST',
                data: function (d) {
                    // 添加分页参数
                    return {
                        start: d.start,      // 起始记录索引
                        length: d.length,    // 每页数量
                        draw: d.draw,        // DataTables绘次数
                        // 搜索条件
                        user_id: $('[name="user_id"]').val(),
                        stock_type_id: $('[name="stock_type_id"]').val(),
                        type: $('[name="type"]').val(),
                        status: $('[name="status"]').val(),
                        date_range: $('[name="date_range"]').val()
                    };
                }
            },
            columns: [
                {data: 'id'},
                {data: 'username'},
                {data: 'mobile'},
                {data: 'stock_name'},
                {data: 'type_text'},
                {data: 'quantity', className: 'text-right'},
                {data: 'price', className: 'text-right', render: $.fn.dataTable.render.number(',', '.', 2)},
                {data: 'amount', className: 'text-right', render: $.fn.dataTable.render.number(',', '.', 2)},
                {data: 'status_text'},
                {data: 'source_text'},
                {data: 'remark'},
                {data: 'created_at'}
            ],
            order: [[0, 'desc']],
            language: {
                // 修复中文显示
                "sProcessing": "处理中...",
                "sLengthMenu": "显示 _MENU_ 项结果",
                "sZeroRecords": "没有匹配结果",
                "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
                "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
                "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
                "sInfoPostFix": "",
                "sSearch": "搜索:",
                "sUrl": "",
                "sEmptyTable": "表中数据为空",
                "sLoadingRecords": "载入中...",
                "sInfoThousands": ",",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上页",
                    "sNext": "下页",
                    "sLast": "末页"
                }
            }
        });

        // 搜索按钮
        $('#search-btn').click(function () {
            table.ajax.reload();
        });
    });
</script>