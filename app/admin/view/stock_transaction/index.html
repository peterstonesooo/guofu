<section class="content">
            <div class="row">
                <div class="col-xs-12">
                    <!-- 搜索框 -->
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <h3 class="box-title">搜索条件</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                    <i class="fa fa-minus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="box-body">
                            <div class="search">
                                <form class="form-inline" id="searchForm">
                                    <input type="text" value="{$req.user??''}" name="user" placeholder="搜索用户手机号/姓名" class="form-control">

                                    <select name="stock_type_id" class="form-control">
                                        <option value="">全部股权类型</option>
                                        {volist name="stockTypes" id="stockType"}
                                        <option value="{$stockType.id}" {if isset($req.stock_type_id) && $req.stock_type_id==$stockType.id}selected{/if}>
                                            {$stockType.name}({$stockType.code})
                                        </option>
                                        {/volist}
                                    </select>

                                    <select name="type" class="form-control">
                                        <option value="">全部交易类型</option>
                                        <option value="1" {if isset($req.type) && $req.type==1}selected{/if}>买入</option>
                                        <option value="2" {if isset($req.type) && $req.type==2}selected{/if}>卖出</option>
                                    </select>

                                    <select name="status" class="form-control">
                                        <option value="">全部状态</option>
                                        <option value="1" {if isset($req.status) && $req.status==1}selected{/if}>成功</option>
                                        <option value="0" {if isset($req.status) && $req.status==0}selected{/if}>失败</option>
                                    </select>

                                    <input placeholder="开始时间" value="{$req.start_date??''}" name="start_date" class="form-control layer-date" id="start">
                                    <span>～</span>
                                    <input placeholder="结束时间" value="{$req.end_date??''}" name="end_date" class="form-control layer-date" id="end">

                                    <button type="submit" class="btn btn-primary btn-flat m_10">
                                        <i class="fa fa-search"></i> 搜索
                                    </button>

                                    <button type="button" id="exportBtn" class="btn btn-info btn-flat m_10">
                                        <i class="fa fa-download"></i> 导出
                                    </button>

                                    <button type="button" id="resetBtn" class="btn btn-default btn-flat m_10">
                                        <i class="fa fa-refresh"></i> 重置
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- 数据表格 -->
                    <div class="box">
                        <div class="box-header">
                            <h3 class="box-title">股权交易记录列表</h3>
                            <div class="box-tools">
                                <div class="input-group input-group-sm" style="width: 150px;">
                                    <input type="text" id="tableSearch" class="form-control pull-right" placeholder="搜索">
                                    <div class="input-group-btn">
                                        <button type="button" class="btn btn-default"><i class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="box-body table-responsive no-padding">
                            <table class="table table-bordered table-hover table-striped">
                                <thead>
                                    <tr>
                                        <th width="100">ID</th>
                                        <th width="150">用户</th>
                                        <th width="150">股权类型</th>
                                        <th width="80">交易类型</th>
                                        <th width="100">交易数量</th>
                                        <th width="100">交易价格</th>
                                        <th width="100">交易金额</th>
                                        <th width="100">来源</th>
                                        <th width="80">状态</th>
                                        <th width="150">交易时间</th>
                                        <th width="100">备注</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {volist name="data" id="v"}
                                    <tr>
                                        <td>{$v.id}</td>
                                        <td>{$v.realname}（{$v.phone}）</td>
                                        <td>{$v.stock_name}({$v.stock_code})</td>
                                        <td>{$v.type_text}</td>
                                        <td>{$v.quantity}</td>
                                        <td>¥{$v.price}</td>
                                        <td>¥{$v.amount}</td>
                                        <td>{$v.source_text}</td>
                                        <td>
                                            {if $v.status == 1}
                                                <span class="label label-success">{$v.status_text}</span>
                                            {else}
                                                <span class="label label-danger">{$v.status_text}</span>
                                            {/if}
                                        </td>
                                        <td>{$v.created_at}</td>
                                        <td>{$v.remark}</td>
                                    </tr>
                                    {/volist}
                                </tbody>
                            </table>
                        </div>
                        <div class="box-footer clearfix">
                            <div style="text-align:center;font-size: 14px;">
                                {$data->render()|raw}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

<script>
$(document).ready(function() {
    // 初始化日期选择器
    laydate.render({
        elem: '#start',
        type: 'datetime',
        theme: '#5b9bd1'
    });
    laydate.render({
        elem: '#end',
        type: 'datetime',
        theme: '#5b9bd1'
    });

    // 表单重置功能
    $('#resetBtn').click(function() {
        // 清空所有文本输入框
        $('#searchForm input[type="text"]').val('');

        // 重置所有下拉选择框到第一个选项（"全部"选项）
        $('#searchForm select').each(function() {
            $(this).prop('selectedIndex', 0);
        });

        // 重新初始化日期选择器以确保显示正确
        laydate.render({
            elem: '#start',
            type: 'datetime',
            theme: '#5b9bd1',
            value: ''
        });
        laydate.render({
            elem: '#end',
            type: 'datetime',
            theme: '#5b9bd1',
            value: ''
        });

        // 可选：立即提交重置后的表单以显示所有数据
        $('#searchForm').submit();
    });

    // 表单提交处理 - 修复参数问题
    $('#searchForm').submit(function(e) {
        // 移除空值的参数
        $(this).find('select, input').each(function() {
            if ($(this).val() === '' || $(this).val() === '0') {
                // 对于空值或0值，移除name属性，使其不会被提交
                var name = $(this).attr('name');
                $(this).attr('name', '');

                // 提交后恢复name属性
                setTimeout(function() {
                    $('[name="' + name + '"]').attr('name', name);
                }, 100);
            }
        });

        // 允许表单正常提交
        return true;
    });

    // 导出功能
    $('#exportBtn').click(function() {
        // 添加导出参数
        $('<input>').attr({
            type: 'hidden',
            name: 'export',
            value: '1'
        }).appendTo('#searchForm');

        // 提交表单
        $('#searchForm').submit();
    });

    // 表格内搜索
    $('#tableSearch').on('keyup', function() {
        var value = $(this).val().toLowerCase();
        $('.table tbody tr').filter(function() {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
    });
});
</script>